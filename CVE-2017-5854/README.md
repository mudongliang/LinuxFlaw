# CVE-2017-5854

## Experiment Environment
Ubuntu 14.04 LTS

## INSTALL & Configuration
```
download PoDoFo from sourceforge
tar xvf podofo.tar.gz
cd podofo 
mkdir build
cmake -G "Unix Makefiles" -DCMAKE_INSTALL_PREFIX="`pwd`/../podofo" -DCMAKE_BUILD_TYPE=Debug ..
make
make install
```

## Problems in Installation & Configuration
CMake Error at /usr/share/cmake-2.8/Modules/FindPackageHandleStandardArgs.cmake:108 (message):  
  Could NOT find FREETYPE (missing: FREETYPE\_LIBRARY FREETYPE\_INCLUDE\_DIR)  
```
sudo apt-get install libfreetype6-dev
```

Could not find fontconfig
```
sudo apt-get install libfontconfig1-dev
```
CMake Error at CMakeLists.txt:36 (CMAKE\_POLICY):
Policy "CMP0033" is not known to this version of CMake.

solution 1: use higher version cmake
solution 2: delete CMakeLists.txt:36

## How to trigger vulnerability
$HOME\_PoDoFo/bin/podofopdfinfo 00143-podofo-nullptr-PdfOutputStream 

## PoCs
[agostino's blog](https://github.com/asarubbo/poc/blob/master/00143-podofo-nullptr-PdfOutputStream)

## Vulnerability Details & Patch

### Root Cause

### Stack Trace
#0  0x080e49e1 in PdfInfo::GuessFormat (this=0xbffff3c8) at tools/podofopdfinfo/pdfinfo.cpp:210
#1  0x080e355c in PdfInfo::OutputDocumentInfo (this=0xbffff3c8, sOutStream=...) at tools/podofopdfinfo/pdfinfo.cpp:40
#2  0x080e6b0a in main (argc=0x2, argv=0xbffff494) at tools/podofopdfinfo/podofopdfinfo.cpp:117
#3  0xb79c4af3 in __libc_start_main (main=0x80e6964 <main(int, char**)>, argc=0x2, argv=0xbffff494, init=0x818b560 <__libc_csu_init>, fini=0x818b5d0 <__libc_csu_fini>, 
    rtld_fini=0xb7fed2d0 <_dl_fini>, stack_end=0xbffff48c) at libc-start.c:287
#4  0x080e3301 in _start ()

## References
